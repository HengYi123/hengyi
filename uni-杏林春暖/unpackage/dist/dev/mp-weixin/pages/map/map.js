"use strict";const t=require("../../common/vendor.js"),a=require("../../common/assets.js"),c={data(){return{latitude:39.90923,longitude:116.397428,currentAddress:"",markers:[{id:1,latitude:39.90923,longitude:116.397428,iconPath:"/static/map/pin.png",width:30,height:40,callout:{content:"当前位置",color:"#fff",bgColor:"#1A73E8",padding:8,borderRadius:4,display:"ALWAYS"}}],controls:[],sourcePage:""}},onLoad(e){this.sourcePage=e.sourcePage||"",this.checkLocationPermission()},onReady(){this.mapContext=t.index.createMapContext("myMap",this)},methods:{checkLocationPermission(){t.index.getSetting({success:e=>{e.authSetting["scope.userLocation"]?this.doLocation():this.currentAddress="请点击定位按钮获取位置"}})},startLocation(){t.index.authorize({scope:"scope.userLocation",success:()=>{this.doLocation()},fail:()=>{t.index.hideLoading(),t.index.showModal({title:"提示",content:"需要位置权限才能获取当前位置",confirmText:"去设置",success:e=>{e.confirm&&t.index.openSetting()}})}})},doLocation(){t.index.showLoading({title:"定位中...",mask:!0}),t.index.getLocation({type:"gcj02",altitude:!0,success:e=>{this.latitude=e.latitude,this.longitude=e.longitude,this.markers[0]={...this.markers[0],latitude:e.latitude,longitude:e.longitude},this.reverseGeocode(e.latitude,e.longitude),this.mapContext.moveToLocation({latitude:e.latitude,longitude:e.longitude,success:()=>{t.index.hideLoading()}})},fail:e=>{t.index.hideLoading(),t.index.showToast({title:"定位失败，请检查权限设置",icon:"none",duration:3e3})}})},async reverseGeocode(e,r){try{const s=await t.index.request({url:`https://restapi.amap.com/v3/geocode/regeo?key=e6ad274c3e0a6139d29e493e3c689bed&location=${r},${e}`});s[1].data.status==="1"?this.currentAddress=s[1].data.regeocode.formatted_address:this.currentAddress="地址解析失败"}catch{this.currentAddress="地址解析失败"}},onControlTap(e){e.controlId===1&&t.index.navigateTo({url:"/pages/map/search"})},goBack(){this.sourcePage==="cart"?t.index.navigateBack({delta:1}):t.index.redirectTo({url:"/pages/index/index"})}}};function d(e,r,s,l,i,o){return{a:a._imports_0$2,b:t.o((...n)=>o.goBack&&o.goBack(...n)),c:i.latitude,d:i.longitude,e:i.markers,f:i.controls,g:t.o((...n)=>o.onControlTap&&o.onControlTap(...n)),h:a._imports_1$3,i:t.o((...n)=>o.startLocation&&o.startLocation(...n)),j:a._imports_2$2,k:t.t(i.currentAddress||"定位中...")}}const u=t._export_sfc(c,[["render",d]]);wx.createPage(u);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/map/map.js.map
