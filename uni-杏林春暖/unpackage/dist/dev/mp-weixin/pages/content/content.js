"use strict";const r=require("../../common/vendor.js"),s=require("../../common/assets.js"),d={},g={data(){return{keyword:"",loading:!0,error:"",flavor:"",effect:"",application:"",pharmacology:"",contraindication:"",cartClicked:!1,cartAdded:!1,sourcePage:""}},onLoad(i){this.keyword=i.keyword?decodeURIComponent(i.keyword):"",this.sourcePage=i.source,r.index.$emit(this.sourcePage),this.loadMedicinesData()},methods:{goBack(){this.sourcePage==="cart"?r.index.navigateBack({delta:1}):r.index.redirectTo({url:"/pages/index/index"})},goToCart(){this.cartClicked=!0,r.index.navigateTo({url:"/pages/shoppingCart/shoppingCart"})},getImage(){return`/static/herb/${this.keyword}.jpg`},async loadMedicinesData(){try{if(this.loading=!0,this.error="",d[this.keyword]){this.extractFields(d[this.keyword]);return}const i=`http://api.zhyunxi.com/api.php?api=87&key=d51b5be2f98dd9bdf06e0bb47dea87fc&name=${encodeURIComponent(this.keyword)}`,[t,o]=await new Promise(c=>{r.index.request({url:i,timeout:1e4,dataType:"json",success:e=>c([e,null]),fail:e=>c([null,e])})});if(r.index.__f__("log","at pages/content/content.vue:137",i),o||!t||t.statusCode!==200)throw new Error((o==null?void 0:o.message)||`请求失败，状态码：${t==null?void 0:t.statusCode}`);if(t.data.code!==0)throw new Error(t.data.msg||"API返回业务错误");if(!t.data.data||t.data.data.length===0)throw new Error(`未找到"${this.keyword}"的相关数据`);d[this.keyword]=t.data,this.extractFields(t.data)}catch(i){this.error=i.message}finally{this.loading=!1}},extractFields(i){if(!(i!=null&&i.data)||!Array.isArray(i.data)){this.error="API返回数据结构异常";return}const t=i.data[0]||{};this.flavor=t.flavor||"无相关信息",this.effect=t.effect||"无相关信息",this.application=t.application||"无相关信息",this.pharmacology=t.pharmacology||"无相关信息",this.contraindication=t.contraindication||"无相关信息"},add(){const i={id:Date.now(),name:this.keyword,price:10.9,image:this.getImage(),quantity:1};let t=r.index.getStorageSync("cart")||[];JSON.stringify(t).length>5*1024*1024&&r.index.showModal({title:"提示",content:"购物车已满，请先结算"});const o=t.find(c=>c.name===this.keyword);o?o.quantity+=1:t.push(i),r.index.setStorageSync("cart",t),r.index.showToast({title:"已添加到购物车",icon:"success",duration:1500}),r.index.$emit("cart-updated",t)}}};function l(i,t,o,c,e,a){return r.e({a:s._imports_0$2,b:r.o((...n)=>a.goBack&&a.goBack(...n)),c:e.loading},e.loading?{}:r.e({d:a.getImage(),e:r.t(e.keyword),f:e.flavor},e.flavor?{g:r.t(e.flavor)}:{},{h:e.effect},e.effect?{i:r.t(e.effect)}:{},{j:e.application},e.application?{k:r.t(e.application)}:{},{l:e.pharmacology},e.pharmacology?{m:r.t(e.pharmacology)}:{},{n:e.contraindication},e.contraindication?{o:r.t(e.contraindication)}:{},{p:e.error},e.error?{q:r.t(e.error)}:{}),{r:s._imports_1$2,s:s._imports_2$1,t:e.cartClicked?"/static/tabbar/购物车-点击后.png":"/static/tabbar/购物车-点击前.png",v:r.o((...n)=>a.goToCart&&a.goToCart(...n)),w:s._imports_3$1,x:r.o((...n)=>a.add&&a.add(...n))})}const h=r._export_sfc(g,[["render",l],["__scopeId","data-v-2cb9dbd4"]]);wx.createPage(h);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/content/content.js.map
