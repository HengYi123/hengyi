{"version":3,"file":"content.js","sources":["pages/content/content.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29udGVudC9jb250ZW50LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"content-page\">\r\n\t\t<view class=\"back\" @click=\"goBack\">\r\n\t\t\t<image src=\"/static/tabbar/返回.png\" class=\"back-image\"></image>\r\n\t\t</view>\r\n\t\t<view v-if=\"loading\" class=\"loading\">数据加载中...\r\n\t\t</view>\r\n\t\t<view v-else class=\"data-container\">\t\r\n\t\t\t<image \r\n\t\t\t\tclass=\"search-image\"\r\n\t\t\t\t:src=getImage()\r\n\t\t\t\tmode=\"widthFix\"\r\n\t\t\t\tlazy-load=\"true\"\r\n\t\t\t\t>\r\n\t\t\t</image>\r\n\t\t\t<view class=\"search-keyword\">{{keyword}}</view>\t\r\n\t\t\t<view class=\"search-keyword-price\">\r\n\t\t\t\t<text class=\"label\">价格:</text>10.9元/克\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"flavor\" class=\"data-item\">\r\n\t\t\t\t<text class=\"label\">味道:</text> {{ flavor }}\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"effect\" class=\"data-item\">\r\n\t\t\t\t<text class=\"label\">功效:</text> {{ effect }}\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"application\" class=\"data-item\">\r\n\t\t\t\t<text class=\"label\">应用:</text> {{ application }}\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"pharmacology\" class=\"data-item\">\r\n\t\t\t\t<text class=\"label\">药理:</text> {{ pharmacology }}\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"contraindication\" class=\"data-item\">\r\n\t\t\t\t<text class=\"label\">禁忌:</text> {{ contraindication }}\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"error\" class=\"error-message\">\r\n\t\t\t\t\t数据获取失败: {{ error }}\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"buttom-tabbar\">\r\n\t\t\t<view class=\"more\">\r\n\t\t\t\t<image src=\"/static/tabbar/店铺.png\" class=\"image-item\"></image>\r\n\t\t\t\t<image src=\"/static/tabbar/客服.png\" class=\"image-item\"></image>\r\n\t\t\t\t<image :src=\"cartClicked ? '/static/tabbar/购物车-点击后.png' : '/static/tabbar/购物车-点击前.png'\"\r\n\t\t\t\t\tclass=\"image-item\" \r\n\t\t\t\t\t@click=\"goToCart\">\r\n\t\t\t\t</image>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"shopBox\">\r\n\t\t\t\t<view \r\n\t\t\t\t\tclass=\"addToCart\"\r\n\t\t\t\t\t@click=\"add\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t<image src=\"/static/tabbar/添加购物车.png\" class=\"add-image\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"shoppingCart\">立即购买</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\n</template>\n\n<script>\r\n\tconst apiCache = {};\r\n\texport default{\r\n\t\tdata(){\r\n\t\t\treturn{\r\n\t\t\t\tkeyword:'',\t\t\t\t// 接受的搜索关键字\r\n\t\t\t\tloading:true,\t\t\t// 加载状态\r\n\t\t\t\terror: '',      \t\t// 错误信息\r\n\t\t\t\tflavor:'',\t\t\t\t// 药材味道\r\n\t\t\t\teffect: '',\t\t\t\t// 药材功效\r\n\t\t\t\tapplication: '',\t\t// 应用场景\r\n\t\t\t\tpharmacology: '',\t\t// 药理作用\r\n\t\t\t\tcontraindication:'',\t// 禁忌说明\r\n\t\t\t\tcartClicked: false, \t// 购物车图标点击状态\r\n\t\t\t\tcartAdded: false,   \t// 添加购物车按钮状态\r\n\t\t\t\tsourcePage: ''\t\t\t// 来源页面标识\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad(options){\r\n\t\t\t// 接收传递的名字\r\n\t\t\tthis.keyword = options.keyword ? decodeURIComponent(options.keyword) : '';\r\n\t\t\t// 记录来源页面标识\r\n\t\t\tthis.sourcePage = options.source;\r\n\t\t\tuni.$emit(this.sourcePage);\r\n\t\t\tthis.loadMedicinesData();\t// 加载药材数据\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t// 返回上一页\r\n\t\t\tgoBack(){\r\n\t\t\t\tif (this.sourcePage === 'cart') {\r\n\t\t\t\t  // 从购物车跳转来时，正常返回\r\n\t\t\t\t  uni.navigateBack({ delta: 1 });\r\n\t\t\t\t} else {\r\n\t\t\t\t  // 其他来源使用重定向\r\n\t\t\t\t  uni.redirectTo({ url: '/pages/index/index' });\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 跳转至购物车页面\r\n\t\t\tgoToCart(){\r\n\t\t\t\tthis.cartClicked = true;\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/shoppingCart/shoppingCart'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 动态生成药材图片路径\r\n\t\t\tgetImage(){\r\n\t\t\t\tconst iamgeData = `/static/herb/${this.keyword}.jpg`;\r\n\t\t\t\treturn\tiamgeData\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 加载药材数据\r\n\t\t\tasync loadMedicinesData() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.loading = true;\r\n\t\t\t\t\tthis.error = '';\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 检查缓存\r\n\t\t\t\t\tif (apiCache[this.keyword]) {\r\n\t\t\t\t\t\tthis.extractFields(apiCache[this.keyword]);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 发起请求\r\n\t\t\t\t\tconst getUrl = `http://api.zhyunxi.com/api.php?api=87&key=d51b5be2f98dd9bdf06e0bb47dea87fc&name=${encodeURIComponent(this.keyword)}`;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst [res, err] = await new Promise(resolve => {\r\n\t\t\t\t\t    uni.request({\r\n\t\t\t\t\t        url: getUrl,\r\n\t\t\t\t\t        timeout: 10000,\r\n\t\t\t\t\t        dataType: 'json',\r\n\t\t\t\t\t        success: (res) => resolve([res, null]),\r\n\t\t\t\t\t        fail: (err) => resolve([null, err])\r\n\t\t\t\t\t    });\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log(getUrl)\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 网络层错误处理\r\n\t\t\t\t\tif (err || !res || res.statusCode !== 200) {\r\n\t\t\t\t\t      throw new Error(err?.message || `请求失败，状态码：${res?.statusCode}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 业务层错误处理\r\n\t\t\t\t\tif (res.data.code !== 0) {\r\n\t\t\t\t\t  throw new Error(res.data.msg || 'API返回业务错误');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 检查数据有效性\r\n\t\t\t\t\tif (!res.data.data || res.data.data.length === 0) {\r\n\t\t\t\t\t  throw new Error(`未找到\"${this.keyword}\"的相关数据`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 缓存数据\r\n\t\t\t\t\tapiCache[this.keyword] = res.data;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 提取所需字段\r\n\t\t\t\t\tthis.extractFields(res.data);\r\n\t\t\t\t\t\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tthis.error = err.message;\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 提取特定字段\r\n\t\t\textractFields(data) {\r\n\t\t\t\t// 检查数据结构\r\n\t\t\t\tif (!data?.data || !Array.isArray(data.data)) {\r\n\t\t\t\t    this.error = 'API返回数据结构异常';\r\n\t\t\t\t    return;\r\n\t\t\t\t}\r\n\t\t\t\t// 提取第一个药材数据\r\n\t\t\t\tconst medicineData = data.data[0] || {};\r\n\t\t\t\t// 根据实际API响应结构调整字段映射\r\n\t\t\t\tthis.flavor = medicineData.flavor || '无相关信息';\r\n\t\t\t\tthis.effect = medicineData.effect || '无相关信息';\r\n\t\t\t\tthis.application = medicineData.application || '无相关信息';\r\n\t\t\t\tthis.pharmacology = medicineData.pharmacology || '无相关信息';\r\n\t\t\t\tthis.contraindication = medicineData.contraindication || '无相关信息';\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 加入购物车功能\r\n\t\t\tadd(){\r\n\t\t\t\tconst cartItem = {\r\n\t\t\t\t\tid:Date.now(),\t\t\t// 唯一ID\r\n\t\t\t\t\tname:this.keyword,\t\t// 商品名称\r\n\t\t\t\t\tprice:10.9,\t\t\t\t// 默认价格\r\n\t\t\t\t\timage:this.getImage(),\t// 商品图片\r\n\t\t\t\t\tquantity:1\t\t\t\t// 初始数量\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 获取当前购物车的本地存储数据\r\n\t\t\t\tlet cart = uni.getStorageSync('cart') || [];\r\n\t\t\t\t// 防止本地存储超限\r\n\t\t\t\tif (JSON.stringify(cart).length > 5 * 1024 * 1024) {\r\n\t\t\t\t    uni.showModal({ title: '提示', content: '购物车已满，请先结算' });\r\n\t\t\t\t}\r\n\t\t\t\t// 检查商品是否已经存在\r\n\t\t\t\tconst existingItem = cart.find(item=>item.name === this.keyword);\r\n\t\t\t\tif(existingItem){\r\n\t\t\t\t\t// 商品已存在，增加数量\r\n\t\t\t\t\texistingItem.quantity +=1;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// 商品不存在，添加到购物车\r\n\t\t\t\t\tcart.push(cartItem);\r\n\t\t\t\t}\r\n\t\t\t\t// 保存更新后的购物车数据\r\n\t\t\t\tuni.setStorageSync('cart',cart);\r\n\t\t\t\t// 显示添加成功提示\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle:'已添加到购物车',\r\n\t\t\t\t\ticon:'success',\r\n\t\t\t\t\tduration:1500\r\n\t\t\t\t});\r\n\t\t\t\t// 更新全局购物车的状态\r\n\t\t\t\tuni.$emit('cart-updated',cart);\r\n\t\t\t}\r\n\t\t}\r\n\t}\n</script>\n\n<style scoped>\r\n\t.content-page{\r\n\t\tbackground-color: #ebebeb;\r\n\t\tmin-height: 100vh;\r\n\t}\r\n\t\r\n\t.back{\r\n\t\tdisplay: flex;\r\n\t\tposition: fixed;\r\n\t\ttop: 100rpx;\r\n\t\tleft: 20rpx;\r\n\t\tz-index: 1000;\r\n\t\tbackground-color: #f4f4f4;\r\n\t\tborder-radius: 50%;\r\n\t\twidth: 60rpx;\r\n\t\theight: 60rpx;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0,0,0,0.1);\r\n\t}\r\n\t\r\n\t.back-image{\r\n\t\twidth: 40rpx;\r\n\t\theight: 40rpx;\r\n\t}\r\n\t\r\n\t.back:active{\r\n\t\ttransform: scale(0.95);\r\n\t\tbackground-color: rgba(240,240,240,0.9);\r\n\t}\r\n\t\r\n\t.loading {\r\n\t\tmax-height: calc(100vh - 170rpx);\r\n\t\toverflow-y: auto;\r\n\t\tpadding-bottom: 120rpx;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\t\r\n\t.data-container {\r\n\t\tmax-height: calc(100vh - 170rpx); \t/* 留出顶部和底部空间 */\r\n\t\toverflow-y: auto; \t\t\t\t\t/* 垂直方向溢出时自动显示滚动条 */\r\n\t\tpadding-bottom: 120rpx; \t\t\t/* 底部留出空间避免被固定栏遮挡 */\r\n\t\tbox-sizing: border-box; \t\t\t/* 包含内边距在高度计算内 */\r\n\t\tfont-size: 36rpx;\r\n\t}\r\n\t\r\n\t.search-keyword {\r\n\t  font-size: 45rpx;\r\n\t  font-weight: bold;\r\n\t  padding: 10rpx;\r\n\t}\r\n\t\r\n\t.search-image{\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\t\r\n\t.data-item{\r\n\t\tpadding: 10rpx;\r\n\t\tfont-size: 36rpx;\r\n\t}\r\n\t\r\n\t.data-item,.search-keyword-price{\r\n\t\tborder-top: #c0c0c0 dashed 2rpx;\r\n\t}\r\n\t\r\n\t.label{\r\n\t\tfont-weight: bold;\r\n\t}\r\n\t\r\n\t.search-keyword-price{\r\n\t\tpadding: 10rpx;\r\n\t\tfont-size: 36rpx;\r\n\t}\r\n\t\r\n\t.buttom-tabbar{\r\n\t\twidth: 100%;\r\n\t\theight: 100rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tposition: fixed;\r\n\t\tbackground-color: rgba(255, 255, 255);\r\n\t\tpadding-bottom: env(safe-area-inset-bottom); /* 适配全面屏手机 */\r\n\t\tbottom: 5rpx; \r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tz-index: 999;\r\n\t}\r\n\t\r\n\t.more{\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: space-around;\r\n\t\talign-items: center;\r\n\t\twidth: 200rpx;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\t\r\n\t.addToCart{\r\n\t\twidth: 120rpx;\r\n\t\ttext-align: center;\r\n\t\tbackground-color: #f1d94d;\r\n\t}\r\n\t\r\n\t.shoppingCart{\r\n\t\tflex:1;\r\n\t\theight: 80rpx;\r\n\t\tbackground-color: #dd4949;\r\n\t\tfont-size: 50rpx;\r\n\t\tcolor: #e8f5e9;\r\n\t\ttext-align: center;\r\n\t}\r\n\t\r\n\t.image-item{\r\n\t\twidth: 50rpx;\r\n\t\theight: 50rpx;\r\n\t}\r\n\t\r\n\t.add-image{\r\n\t\twidth: 70rpx;\r\n\t\theight: 70rpx;\r\n\t}\r\n\t\r\n\t.shopBox{\r\n\t\tborder-radius: 20rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: center;\r\n\t\twidth: 500rpx;\r\n\t}\n</style>","import MiniProgramPage from 'D:/xiaochengxu/project-space/uni-杏林春暖/pages/content/content.vue'\nwx.createPage(MiniProgramPage)"],"names":["apiCache","_sfc_main","options","uni","getUrl","res","err","resolve","data","medicineData","cartItem","cart","existingItem","item","MiniProgramPage"],"mappings":"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"}