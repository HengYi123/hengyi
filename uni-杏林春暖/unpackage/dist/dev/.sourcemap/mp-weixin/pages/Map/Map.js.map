{"version":3,"file":"map.js","sources":["pages/map/map.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWFwL21hcC52dWU"],"sourcesContent":["<template>\r\n\t<!-- 返回按钮 -->\r\n\t<view class=\"back\" @click=\"goBack\">\r\n\t\t<image src=\"/static/tabbar/返回.png\" class=\"back-image\"></image>\r\n\t</view>\r\n\t<!-- 地图容器 -->\r\n\t<map \r\n\t\tid=\"myMap\"\r\n\t\tclass=\"map-container\"\r\n\t\t:latitude=\"latitude\"\r\n\t\t:longitude=\"longitude\"\r\n\t\t:markers=\"markers\"\r\n\t\t:show-location=\"true\"\r\n\t\t:controls=\"controls\"\r\n\t\t@controltap=\"onControlTap\"\r\n\t></map>\r\n\t\r\n\t<!-- 定位按钮 -->\r\n\t<view class=\"locate-btn\" @click=\"startLocation\">\r\n\t\t<image src=\"/static/map/location.png\"></image>\r\n\t</view>\r\n\t\r\n\t<!-- 地址显示栏 -->\r\n\t<view class=\"address-bar\">\r\n\t\t<image src=\"/static/map/location-pin.png\" class=\"address-icon\"></image>\r\n\t\t<text class=\"address-text\">{{ currentAddress || '定位中...' }}</text>\r\n\t</view>\r\n\t\r\n\t<!-- 地图水印 -->\r\n\t<view class=\"map-watermark\">\r\n\t\t<text>高德地图</text>\r\n\t\t<text>©2025 AMap · GS 撖 (2023)1171号</text>\r\n\t</view>\n</template>\n\n<script>\t\r\n\texport default{\r\n\t\tdata(){\r\n\t\t\treturn {\r\n\t\t\t\tlatitude: 39.90923, \t\t\t\t\t// 默认北京坐标\r\n\t\t\t\tlongitude: 116.397428,\t\t\t\t\t// 初始中心经度\r\n\t\t\t\tcurrentAddress: '',\t\t\t\t\t\t// 当前地址文本\r\n\t\t\t\tmarkers: [{\t\t\t\t\t\t\t\t// 标记点配置\r\n\t\t\t\t\tid: 1,\r\n\t\t\t\t\tlatitude: 39.90923,\r\n\t\t\t\t\tlongitude: 116.397428,\r\n\t\t\t\t\ticonPath: '/static/map/pin.png',\t// 标记图标\r\n\t\t\t\t\twidth: 30,\t\t\t\r\n\t\t\t\t\theight: 40,\r\n\t\t\t\t\tcallout: {\t\t\t\t\t\t\t// 标记点气泡\r\n\t\t\t\t\t\tcontent: '当前位置',\r\n\t\t\t\t\t\tcolor: '#fff',\r\n\t\t\t\t\t\tbgColor: '#1A73E8',\r\n\t\t\t\t\t\tpadding: 8,\r\n\t\t\t\t\t\tborderRadius: 4,\r\n\t\t\t\t\t\tdisplay: 'ALWAYS'\t\t\t\t// 常显气泡\r\n\t\t\t\t\t}\r\n\t\t\t\t}],\r\n\t\t\t\tcontrols: [],\t\t\t\t\t\t\t// 地图控件数组\r\n\t\t\t\tsourcePage:''\t\t\t\t\t\t\t// 页面来源标识\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonLoad(options){\r\n\t\t\t// 记录来源页面\r\n\t\t\tthis.sourcePage = options.sourcePage || '';\t\r\n\t\t\t// 页面加载即定位\r\n\t\t\tthis.checkLocationPermission(); \t\t\t\r\n\t\t},\r\n\t\t\r\n\t\tonReady(){\r\n\t\t\t// 创建地图实例\r\n\t\t\tthis.mapContext = uni.createMapContext('myMap',this);\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t// 检查定位权限状态\r\n\t\t\tcheckLocationPermission() {\r\n\t\t\t    uni.getSetting({\r\n\t\t\t      success: (res) => {\r\n\t\t\t        if (res.authSetting['scope.userLocation']) {\r\n\t\t\t          // 已有权限，直接定位\r\n\t\t\t          this.doLocation();\r\n\t\t\t        } else {\r\n\t\t\t          // 无权限，显示提示但不强制请求\r\n\t\t\t          this.currentAddress = '请点击定位按钮获取位置';\r\n\t\t\t        }\r\n\t\t\t      }\r\n\t\t\t    });\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 触发定位流程\r\n\t\t\tstartLocation() {\r\n\t\t\t  // 先检查并请求定位权限\r\n\t\t\t  uni.authorize({\r\n\t\t\t    scope: 'scope.userLocation',\r\n\t\t\t    success: () => {\r\n\t\t\t      // 权限已授予，开始定位\r\n\t\t\t      this.doLocation();\r\n\t\t\t    },\r\n\t\t\t    fail: () => {\r\n\t\t\t      uni.hideLoading();\r\n\t\t\t      uni.showModal({\r\n\t\t\t        title: '提示',\r\n\t\t\t        content: '需要位置权限才能获取当前位置',\r\n\t\t\t        confirmText: '去设置',\r\n\t\t\t        success: (res) => {\r\n\t\t\t          if (res.confirm) {\r\n\t\t\t            // 引导用户打开设置\r\n\t\t\t            uni.openSetting();\r\n\t\t\t          }\r\n\t\t\t        }\r\n\t\t\t      });\r\n\t\t\t    }\r\n\t\t\t  });\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 实时定位核心方法\r\n\t\t\tdoLocation() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '定位中...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\tuni.getLocation({\r\n\t\t\t\t\ttype: 'gcj02', \t\t// 高德坐标系\r\n\t\t\t\t\taltitude: true,\t \t// 获取高度信息\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t// 更新坐标数据\r\n\t\t\t\t\t\tthis.latitude = res.latitude;\r\n\t\t\t\t\t\tthis.longitude = res.longitude;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 更新标记点\r\n\t\t\t\t\t\tthis.markers[0] = {\r\n\t\t\t\t\t\t\t...this.markers[0],\r\n\t\t\t\t\t\t\tlatitude: res.latitude,\r\n\t\t\t\t\t\t\tlongitude: res.longitude\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 坐标转地址（逆地理编码）\r\n\t\t\t\t\t\tthis.reverseGeocode(res.latitude, res.longitude);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 移动地图视角到当前位置\r\n\t\t\t\t\t\tthis.mapContext.moveToLocation({\r\n\t\t\t\t\t\t\tlatitude: res.latitude,\r\n\t\t\t\t\t\t\tlongitude: res.longitude,\r\n\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tuni.showToast({ \r\n\t\t\t\t\t\t\ttitle: '定位失败，请检查权限设置', \r\n\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\tduration: 3000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 逆地理编码\r\n\t\t\tasync reverseGeocode(lat, lng) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst res = await uni.request({\r\n\t\t\t\t\t\turl: `https://restapi.amap.com/v3/geocode/regeo?key=e6ad274c3e0a6139d29e493e3c689bed&location=${lng},${lat}`\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (res[1].data.status === '1') {\r\n\t\t\t\t\t\tthis.currentAddress = res[1].data.regeocode.formatted_address;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.currentAddress = '地址解析失败';\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tthis.currentAddress = '地址解析失败';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 控件点击事件\r\n\t\t\tonControlTap(e) {\r\n\t\t\t\tif (e.controlId === 1) {\r\n\t\t\t\t\tuni.navigateTo({ url: '/pages/map/search' });\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 返回逻辑\r\n\t\t\tgoBack(){\r\n\t\t\t\tif (this.sourcePage === 'cart') {\r\n\t\t\t\t  // 从购物车跳转来时，正常返回\r\n\t\t\t\t  uni.navigateBack({ delta: 1 });\r\n\t\t\t\t} else {\r\n\t\t\t\t  // 其他来源（如主页）使用重定向\r\n\t\t\t\t  uni.redirectTo({ url: '/pages/index/index' });\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n\t\n</script>\n\n<style>\r\n\t.back{\r\n\t\tdisplay: flex;\r\n\t\tposition: fixed;\r\n\t\ttop: 100rpx;\r\n\t\tleft: 20rpx;\r\n\t\tz-index: 1000;\r\n\t\tbackground-color: #f4f4f4;\r\n\t\tborder-radius: 50%;\r\n\t\twidth: 60rpx;\r\n\t\theight: 60rpx;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0,0,0,0.1);\r\n\t}\r\n\t\r\n\t.back-image{\r\n\t\twidth: 40rpx;\r\n\t\theight: 40rpx;\r\n\t}\r\n\t\r\n\t.back:active{\r\n\t\ttransform: scale(0.95);\r\n\t\tbackground-color: rgba(240,240,240,0.9);\r\n\t}\r\n\t\r\n\t.map-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100vh;\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t}\r\n\t\r\n\t.locate-btn {\r\n\t\tposition: fixed;\r\n\t\tright: 30rpx;\r\n\t\tbottom: 250rpx;\r\n\t\twidth: 90rpx;\r\n\t\theight: 90rpx;\r\n\t\tbackground: white;\r\n\t\tborder-radius: 50%;\r\n\t\tbox-shadow: 0 0 10px rgba(0,0,0,0.2);\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tz-index: 100;\r\n\t}\r\n\t\r\n\t.locate-icon {\r\n\t\twidth: 50rpx;\r\n\t\theight: 50rpx;\r\n\t}\r\n\t\r\n\t.address-bar {\r\n\t\tposition: fixed;\r\n\t\tbottom: 140rpx;\r\n\t\tleft: 30rpx;\r\n\t\tright: 30rpx;\r\n\t\tbackground: rgba(255, 255, 255, 0.9);\r\n\t\tpadding: 25rpx 30rpx;\r\n\t\tborder-radius: 16rpx;\r\n\t\tbox-shadow: 0 4rpx 20rpx rgba(0,0,0,0.1);\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tz-index: 100;\r\n\t}\r\n\t\r\n\t.address-icon {\r\n\t\twidth: 40rpx;\r\n\t\theight: 40rpx;\r\n\t\tmargin-right: 15rpx;\r\n\t}\r\n\t\r\n\t.address-text {\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #333;\r\n\t\tflex: 1;\r\n\t}\r\n\t\r\n\t.map-watermark {\r\n\t\tposition: fixed;\r\n\t\tbottom: 30rpx;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tz-index: 50;\r\n\t}\r\n\t\r\n\t.map-watermark text {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: rgba(0, 0, 0, 0.5);\r\n\t\tline-height: 1.5;\r\n\t}\n</style>","import MiniProgramPage from 'D:/xiaochengxu/project-space/uni-杏林春暖/pages/map/map.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","options","uni","res","err","lat","lng","MiniProgramPage"],"mappings":"2FAoCMA,EAAS,CACb,MAAM,CACL,MAAO,CACN,SAAU,SACV,UAAW,WACX,eAAgB,GAChB,QAAS,CAAC,CACT,GAAI,EACJ,SAAU,SACV,UAAW,WACX,SAAU,sBACV,MAAO,GACP,OAAQ,GACR,QAAS,CACR,QAAS,OACT,MAAO,OACP,QAAS,UACT,QAAS,EACT,aAAc,EACd,QAAS,QACV,CACD,CAAC,EACD,SAAU,CAAE,EACZ,WAAW,EACZ,CACA,EAED,OAAOC,EAAQ,CAEd,KAAK,WAAaA,EAAQ,YAAc,GAExC,KAAK,wBAAuB,CAC5B,EAED,SAAS,CAER,KAAK,WAAaC,EAAG,MAAC,iBAAiB,QAAQ,IAAI,CACnD,EACD,QAAQ,CAEP,yBAA0B,CACtBA,EAAAA,MAAI,WAAW,CACb,QAAUC,GAAQ,CACZA,EAAI,YAAY,oBAAoB,EAEtC,KAAK,WAAU,EAGf,KAAK,eAAiB,aAE1B,CACF,CAAC,CACJ,EAGD,eAAgB,CAEdD,EAAAA,MAAI,UAAU,CACZ,MAAO,qBACP,QAAS,IAAM,CAEb,KAAK,WAAU,CAChB,EACD,KAAM,IAAM,CACVA,EAAG,MAAC,YAAW,EACfA,EAAAA,MAAI,UAAU,CACZ,MAAO,KACP,QAAS,iBACT,YAAa,MACb,QAAUC,GAAQ,CACZA,EAAI,SAEND,EAAG,MAAC,YAAW,CAEnB,CACF,CAAC,CACH,CACF,CAAC,CACF,EAGD,YAAa,CACZA,EAAAA,MAAI,YAAY,CACf,MAAO,SACP,KAAM,EACP,CAAC,EACDA,EAAAA,MAAI,YAAY,CACf,KAAM,QACN,SAAU,GACV,QAAUC,GAAQ,CAEjB,KAAK,SAAWA,EAAI,SACpB,KAAK,UAAYA,EAAI,UAGrB,KAAK,QAAQ,CAAC,EAAI,CACjB,GAAG,KAAK,QAAQ,CAAC,EACjB,SAAUA,EAAI,SACd,UAAWA,EAAI,WAIhB,KAAK,eAAeA,EAAI,SAAUA,EAAI,SAAS,EAG/C,KAAK,WAAW,eAAe,CAC9B,SAAUA,EAAI,SACd,UAAWA,EAAI,UACf,QAAS,IAAM,CACdD,EAAG,MAAC,YAAW,CAChB,CACD,CAAC,CACD,EACD,KAAOE,GAAQ,CACdF,EAAG,MAAC,YAAW,EACfA,EAAAA,MAAI,UAAU,CACb,MAAO,eACP,KAAM,OACN,SAAU,GACX,CAAC,CACF,CACD,CAAC,CACD,EAGD,MAAM,eAAeG,EAAKC,EAAK,CAC9B,GAAI,CACH,MAAMH,EAAM,MAAMD,EAAG,MAAC,QAAQ,CAC7B,IAAK,2FAA2FI,CAAG,IAAID,CAAG,EAC3G,CAAC,EACGF,EAAI,CAAC,EAAE,KAAK,SAAW,IAC1B,KAAK,eAAiBA,EAAI,CAAC,EAAE,KAAK,UAAU,kBAE5C,KAAK,eAAiB,QAExB,MAAY,CACX,KAAK,eAAiB,QACvB,CACA,EAGD,aAAa,EAAG,CACX,EAAE,YAAc,GACnBD,EAAAA,MAAI,WAAW,CAAE,IAAK,mBAAqB,CAAA,CAE5C,EAGD,QAAQ,CACH,KAAK,aAAe,OAEtBA,EAAAA,MAAI,aAAa,CAAE,MAAO,CAAG,CAAA,EAG7BA,EAAAA,MAAI,WAAW,CAAE,IAAK,oBAAsB,CAAA,CAE9C,CACF,CACD,qWCjMD,GAAG,WAAWK,CAAe"}